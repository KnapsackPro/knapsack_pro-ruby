#!/bin/bash

CI_BUILD_ID=$(openssl rand -base64 32)

export PARALLEL_TESTS_CONCURRENCY=2;

KNAPSACK_PRO_ENDPOINT=http://api.knapsackpro.localhost:3000 \
  KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC=a28ce51204d7c7dbd25c3352fea222cf \
  KNAPSACK_PRO_REPOSITORY_ADAPTER=git \
  KNAPSACK_PRO_PROJECT_DIR=. \
  PARALLEL_TESTS_CONCURRENCY=$PARALLEL_TESTS_CONCURRENCY \
  KNAPSACK_PRO_CI_NODE_BUILD_ID=${1:-$CI_BUILD_ID} \
  bundle exec parallel_test -n $PARALLEL_TESTS_CONCURRENCY -e './bin/parallel_tests_knapsack_pro_single_machine'
